


<% calendar_year_schedule = CalendarSchedule.new({year: session[:year]}) %>
<% calendar_month_user_array = calendar_year_schedule.get_month(month) %>
<!-- set selected user to nil if none provided -->
<% session[:selected_user] = "not_a_user" if !session[:selected_user] %>
<% @user = User.where(name: session[:selected_user])[0] unless session[:selected_user] == "not_a_user" %>
<!-- next and previous months -->
<div class="calendar-header">
	<a class="cal_link left" href="/changemonth/<%= month - 1 %>">< Prev</a>

	<h3><%= "#{month_integer_to_string(month)} #{session[:year]}" %></h3>
	<a class="cal_link right" href="/changemonth/<%= month + 1 %>">Next ></a>
</div>
<table class="calendar">
	<tr>
		<% ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"].each do |day| %>
			<th><%= day %></th>
		<% end %>
	</tr>

	
	<!-- loop through all the weeks in the month -->
	<% (calendar_month_user_array.length/7 ).times do |week_index| %>
		<tr>
			<% 7.times do |day_index| %>
			<% current_day =  calendar_month_user_array[day_index + (week_index*7)]%>
				<td <%= 'class=selected' if session[:selected_user] == current_day.scheduled_user_name %> data-date='<%= "#{current_day.num}-#{month}-#{session[:year]}" %>'>
					<div class="num">
						<%= current_day.num %>
					</div>
					<a href="/users/<%= current_day.scheduled_user_id %>" class="name">
						<%= current_day.scheduled_user_name %>
					</a>
					  <% if session[:selected_user] == current_day.scheduled_user_name %>
						  <div class="cant-do">

						 	  <%= render partial: 'users/no_can_do_day_form' %>

						   </div>
					  <% elsif session[:show] && current_day.scheduled_user_id %>
					    <%= render partial: 'shared/swap_day_form', :locals => {day: DayAssignment.where(date: current_day.date)[0], user: User.find(session[:user_id]) } %> 
					  <% end %>
				</td>
			<% end %>

		</tr>

	<% end %>

</table>

<div data-date="2015-02-03"></div>